{
  "version": 3,
  "sources": ["../scripts/UIKeyValueStringFilter.ts"],
  "sourcesContent": ["import { IS, IS_NOT, NO, UIObject, YES } from \"./UIObject\"\n// @ts-ignore\nimport UIKeyValueStringFilterWebWorker from \"./UIKeyValueStringFilterWebWorker.worker.js\"\n\n\n\n\n\nexport class UIKeyValueStringFilter extends UIObject {\n    \n    \n    static _sharedWebWorkerHolder = { webWorker: new UIKeyValueStringFilterWebWorker() }\n    \n    static _instanceNumber = -1\n    \n    \n    _instanceNumber: number\n    \n    _isThreadClosed = NO\n    \n    private _webWorkerHolder = UIKeyValueStringFilter._sharedWebWorkerHolder\n    \n    constructor(useSeparateWebWorkerHolder = NO) {\n        \n        \n        super()\n        \n        if (useSeparateWebWorkerHolder) {\n            \n            this._webWorkerHolder = { webWorker: new UIKeyValueStringFilterWebWorker() }\n            \n        }\n        \n        UIKeyValueStringFilter._instanceNumber = UIKeyValueStringFilter._instanceNumber + 1\n        this._instanceNumber = UIKeyValueStringFilter._instanceNumber\n        \n        if (IS_NOT(this._webWorkerHolder.webWorker.onmessage)) {\n            \n            this._webWorkerHolder.webWorker.onmessage = message => {\n                \n                this.isWorkerBusy = NO\n                this.postNextMessageIfNeeded()\n                \n                const key = \"\" + message.data.identifier + message.data.instanceIdentifier\n                \n                const completionFunction = this.completionFunctions[key]\n                \n                if (IS(completionFunction)) {\n                    \n                    //console.log(\"Filtering took \" + (Date.now() - startTime) + \" ms\");\n                    \n                    completionFunction(message.data.filteredData, message.data.filteredIndexes, message.data.identifier)\n                    \n                }\n                \n                delete this.completionFunctions[key]\n                \n                var asd = 1\n                \n            }\n            \n        }\n        \n        \n        \n        \n        \n    }\n    \n    \n    \n    \n    \n    get instanceIdentifier() {\n        \n        return this._instanceNumber\n        \n    }\n    \n    \n    get completionFunctions() {\n        \n        const key = \"UICore_completionFunctions\"\n        var result: {\n            \n            [x: string]: (filteredData: string[], filteredIndexes: number[], identifier: any) => void;\n            \n        } = this._webWorkerHolder[key]\n        \n        if (IS_NOT(result)) {\n            \n            result = {}\n            this._webWorkerHolder[key] = result\n            \n        }\n        \n        return result\n        \n    }\n    \n    get messagesToPost() {\n        \n        const key = \"UICore_messagesToPost\"\n        var result: any[] = this._webWorkerHolder[key]\n        \n        if (IS_NOT(result)) {\n            \n            result = []\n            this._webWorkerHolder[key] = result\n            \n        }\n        \n        return result\n        \n    }\n    \n    \n    set isWorkerBusy(isWorkerBusy: boolean) {\n        \n        this._webWorkerHolder[\"UICore_isWorking\"] = isWorkerBusy\n        \n    }\n    \n    get isWorkerBusy() {\n        \n        return IS(this._webWorkerHolder[\"UICore_isWorking\"])\n        \n    }\n    \n    \n    postNextMessageIfNeeded() {\n        \n        if (this.messagesToPost.length && IS_NOT(this.isWorkerBusy)) {\n            \n            this._webWorkerHolder.webWorker.postMessage(this.messagesToPost.firstElement)\n            this.messagesToPost.removeElementAtIndex(0)\n            \n            this.isWorkerBusy = YES\n            \n        }\n        \n    }\n    \n    \n    \n    \n    filterData(\n        filteringString: string,\n        data: any[],\n        excludedData: string[],\n        dataKeyPath: string,\n        identifier: any,\n        completion: (filteredData: string[], filteredIndexes: number[], identifier: any) => void\n    ) {\n        \n        \n        if (this._isThreadClosed) {\n            \n            return\n            \n        }\n        \n        \n        \n        const instanceIdentifier = this.instanceIdentifier\n        \n        const key = \"\" + identifier + instanceIdentifier\n        \n        this.completionFunctions[key] = completion\n        \n        \n        try {\n            \n            this.messagesToPost.push({\n                \n                \"filteringString\": filteringString,\n                \"data\": data,\n                \"excludedData\": excludedData,\n                \"dataKeyPath\": dataKeyPath,\n                \"identifier\": identifier,\n                \"instanceIdentifier\": instanceIdentifier\n                \n            })\n            \n            this.postNextMessageIfNeeded()\n            \n        } catch (exception) {\n            \n            completion([], [], identifier)\n            \n        }\n        \n        \n        \n        \n        \n    }\n    \n    \n    \n    \n    \n    closeThread() {\n        \n        this._isThreadClosed = YES\n        \n        if (this._webWorkerHolder != UIKeyValueStringFilter._sharedWebWorkerHolder) {\n            \n            this._webWorkerHolder.webWorker.terminate()\n            \n        }\n        \n        \n        \n    }\n    \n    \n    \n    \n    \n}\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n"],
  "mappings": ";;;;;;;;;;;;;;;;;;;;;;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,sBAA8C;AAE9C,oDAA4C;AAMrC,MAAM,0BAAN,cAAqC,yBAAS;AAAA,EAcjD,YAAY,6BAA6B,oBAAI;AAGzC,UAAM;AAPV,2BAAkB;AAElB,SAAQ,mBAAmB,wBAAuB;AAO9C,QAAI,4BAA4B;AAE5B,WAAK,mBAAmB,EAAE,WAAW,IAAI,8CAAAA,QAAgC,EAAE;AAAA,IAE/E;AAEA,4BAAuB,kBAAkB,wBAAuB,kBAAkB;AAClF,SAAK,kBAAkB,wBAAuB;AAE9C,YAAI,wBAAO,KAAK,iBAAiB,UAAU,SAAS,GAAG;AAEnD,WAAK,iBAAiB,UAAU,YAAY,aAAW;AAEnD,aAAK,eAAe;AACpB,aAAK,wBAAwB;AAE7B,cAAM,MAAM,KAAK,QAAQ,KAAK,aAAa,QAAQ,KAAK;AAExD,cAAM,qBAAqB,KAAK,oBAAoB;AAEpD,gBAAI,oBAAG,kBAAkB,GAAG;AAIxB,6BAAmB,QAAQ,KAAK,cAAc,QAAQ,KAAK,iBAAiB,QAAQ,KAAK,UAAU;AAAA,QAEvG;AAEA,eAAO,KAAK,oBAAoB;AAEhC,YAAI,MAAM;AAAA,MAEd;AAAA,IAEJ;AAAA,EAMJ;AAAA,EAMA,IAAI,qBAAqB;AAErB,WAAO,KAAK;AAAA,EAEhB;AAAA,EAGA,IAAI,sBAAsB;AAEtB,UAAM,MAAM;AACZ,QAAI,SAIA,KAAK,iBAAiB;AAE1B,YAAI,wBAAO,MAAM,GAAG;AAEhB,eAAS,CAAC;AACV,WAAK,iBAAiB,OAAO;AAAA,IAEjC;AAEA,WAAO;AAAA,EAEX;AAAA,EAEA,IAAI,iBAAiB;AAEjB,UAAM,MAAM;AACZ,QAAI,SAAgB,KAAK,iBAAiB;AAE1C,YAAI,wBAAO,MAAM,GAAG;AAEhB,eAAS,CAAC;AACV,WAAK,iBAAiB,OAAO;AAAA,IAEjC;AAEA,WAAO;AAAA,EAEX;AAAA,EAGA,IAAI,aAAa,cAAuB;AAEpC,SAAK,iBAAiB,sBAAsB;AAAA,EAEhD;AAAA,EAEA,IAAI,eAAe;AAEf,eAAO,oBAAG,KAAK,iBAAiB,mBAAmB;AAAA,EAEvD;AAAA,EAGA,0BAA0B;AAEtB,QAAI,KAAK,eAAe,cAAU,wBAAO,KAAK,YAAY,GAAG;AAEzD,WAAK,iBAAiB,UAAU,YAAY,KAAK,eAAe,YAAY;AAC5E,WAAK,eAAe,qBAAqB,CAAC;AAE1C,WAAK,eAAe;AAAA,IAExB;AAAA,EAEJ;AAAA,EAKA,WACI,iBACA,MACA,cACA,aACA,YACA,YACF;AAGE,QAAI,KAAK,iBAAiB;AAEtB;AAAA,IAEJ;AAIA,UAAM,qBAAqB,KAAK;AAEhC,UAAM,MAAM,KAAK,aAAa;AAE9B,SAAK,oBAAoB,OAAO;AAGhC,QAAI;AAEA,WAAK,eAAe,KAAK;AAAA,QAErB,mBAAmB;AAAA,QACnB,QAAQ;AAAA,QACR,gBAAgB;AAAA,QAChB,eAAe;AAAA,QACf,cAAc;AAAA,QACd,sBAAsB;AAAA,MAE1B,CAAC;AAED,WAAK,wBAAwB;AAAA,IAEjC,SAAS,WAAP;AAEE,iBAAW,CAAC,GAAG,CAAC,GAAG,UAAU;AAAA,IAEjC;AAAA,EAMJ;AAAA,EAMA,cAAc;AAEV,SAAK,kBAAkB;AAEvB,QAAI,KAAK,oBAAoB,wBAAuB,wBAAwB;AAExE,WAAK,iBAAiB,UAAU,UAAU;AAAA,IAE9C;AAAA,EAIJ;AAMJ;AApNO,IAAM,yBAAN;AAAM,uBAGF,yBAAyB,EAAE,WAAW,IAAI,8CAAAA,QAAgC,EAAE;AAH1E,uBAKF,kBAAkB;",
  "names": ["UIKeyValueStringFilterWebWorker"]
}
